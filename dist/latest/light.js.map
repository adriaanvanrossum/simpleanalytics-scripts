{"version":3,"file":"light.source.js","sources":["light.source.js"],"sourcesContent":["/* eslint-env browser */\n\n(function (window, overwriteOptions, baseUrl, apiUrlPrefix, version, saGlobal) {\n  try {\n    // Only load our script once, customers can still send multiple page views\n    // with the sa_pageview function if they turn off auto collect.\n    var loadedVariable = saGlobal + \"_loaded\";\n    if (!window || window[loadedVariable] === true) return;\n    window[loadedVariable] = true;\n\n    /////////////////////\n    // PREDEFINED VARIABLES FOR BETTER MINIFICATION\n    //\n\n    // This seems like a lot of repetition, but it makes our script available for\n    // multple destination which prevents us to need multiple scripts. The minified\n    // version stays small.\n    var https = \"https:\";\n    var pageviewsText = \"pageview\";\n    var slash = \"/\";\n    var protocol = https + \"//\";\n    var con = window.console;\n    var doNotTrack = \"doNotTrack\";\n    var nav = window.navigator;\n    var loc = window.location;\n    var locationHostname = loc.hostname;\n    var doc = window.document;\n    var userAgent = nav.userAgent;\n    var notSending = \"Not sending request \";\n    var fetchedHighEntropyValues = false;\n    var encodeURIComponentFunc = encodeURIComponent;\n    var decodeURIComponentFunc = decodeURIComponent;\n    var stringify = JSON.stringify;\n    var thousand = 1000;\n    var addEventListenerFunc = window.addEventListener;\n    var fullApiUrl = protocol + apiUrlPrefix + baseUrl;\n    var undefinedVar = undefined;\n    var documentElement = doc.documentElement || {};\n    var language = \"language\";\n    var Height = \"Height\";\n    var Width = \"Width\";\n    var scroll = \"scroll\";\n    var trueText = \"true\";\n    var uaData = nav.userAgentData;\n    var scrollHeight = scroll + Height;\n    var offsetHeight = \"offset\" + Height;\n    var clientHeight = \"client\" + Height;\n    var clientWidth = \"client\" + Width;\n    var pagehide = \"pagehide\";\n    var platformText = \"platform\";\n    var platformVersionText = \"platformVersion\";\n    var docsUrl = \"https://docs.simpleanalytics.com\";\n    var isBotAgent =\n      /(bot|spider|crawl)/i.test(userAgent) && !/(cubot)/i.test(userAgent);\n\n    /////////////////////\n    // HELPER FUNCTIONS\n    //\n\n    // A simple log function so the user knows why a request is not being send\n    var warn = function (message) {\n      if (con && con.warn) con.warn(\"Simple Analytics:\", message);\n    };\n\n    var now = Date.now;\n\n    var uuid = function () {\n      var cryptoObject = window.crypto || window.msCrypto;\n      var emptyUUID = [1e7] + -1e3 + -4e3 + -8e3 + -1e11;\n      var uuidRegex = /[018]/g;\n\n      try {\n        return emptyUUID.replace(uuidRegex, function (c) {\n          return (\n            c ^\n            (cryptoObject.getRandomValues(new Uint8Array(1))[0] &\n              (15 >> (c / 4)))\n          ).toString(16);\n        });\n      } catch (error) {\n        return emptyUUID.replace(uuidRegex, function (c) {\n          var r = (Math.random() * 16) | 0,\n            v = c < 2 ? r : (r & 0x3) | 0x8;\n          return v.toString(16);\n        });\n      }\n    };\n\n    var isFunction = function (func) {\n      return typeof func == \"function\";\n    };\n\n    var isString = function (string) {\n      return typeof string == \"string\";\n    };\n\n    var assign = function () {\n      var to = {};\n      var arg = arguments;\n      for (var index = 0; index < arg.length; index++) {\n        var nextSource = arg[index];\n        if (nextSource) {\n          for (var nextKey in nextSource) {\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n\n    var isBoolean = function (value) {\n      return !!value === value;\n    };\n\n    var getParams = function (regex) {\n      // From the search we grab the utm_source and ref and save only that\n      var matches = loc.search.match(\n        new RegExp(\"[?&](\" + regex + \")=([^?&]+)\", \"gi\")\n      );\n      var match = matches\n        ? matches.map(function (m) {\n            return m.split(\"=\")[1];\n          })\n        : [];\n      if (match && match[0]) return match[0];\n    };\n\n\n    /////////////////////\n    // SEND DATA VIA OUR PIXEL\n    //\n\n    // Send data via image\n    var sendData = function (data, callback) {\n      data = assign(payload, page, data);\n\n      var image = new Image();\n      image.src =\n        fullApiUrl +\n        \"/simple.gif?\" +\n        Object.keys(data)\n          .filter(function (key) {\n            return data[key] != undefinedVar;\n          })\n          .map(function (key) {\n            return (\n              encodeURIComponentFunc(key) +\n              \"=\" +\n              encodeURIComponentFunc(data[key])\n            );\n          })\n          .join(\"&\") +\n        \"&time=\" +\n        Date.now();\n    };\n\n\n    /////////////////////\n    // INITIALIZE VALUES\n    //\n\n\n\n\n    // This code could error on (incomplete) implementations, that's why we use try...catch\n    var timezone;\n    try {\n      timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n    } catch (e) {\n      /* Do nothing */\n    }\n\n    /////////////////////\n    // GET SETTINGS\n    //\n\n    // Find the script element where options can be set on\n    var scriptElement =\n      doc.currentScript || doc.querySelector('script[src*=\"' + baseUrl + '\"]');\n    var attr = function (scriptElement, attribute) {\n      return scriptElement && scriptElement.getAttribute(\"data-\" + attribute);\n    };\n\n    // Script mode, this can be hash mode for example\n    var mode = overwriteOptions.mode || attr(scriptElement, \"mode\");\n\n\n    // Customers can overwrite their hostname, here we check for that\n    var overwrittenHostname =\n      overwriteOptions.hostname || attr(scriptElement, \"hostname\");\n    var definedHostname = overwrittenHostname || locationHostname;\n\n\n\n\n    // Customers can ignore certain pages\n    var ignorePagesRaw =\n      overwriteOptions.ignorePages || attr(scriptElement, \"ignore-pages\");\n\n    /////////////////////\n    // PAYLOAD FOR BOTH PAGE VIEWS AND EVENTS\n    //\n\n    var bot = isBotAgent;\n\n    var payload = {\n      version: version,\n      ua: userAgent,\n      https: loc.protocol == https,\n      timezone: timezone,\n      hostname: definedHostname,\n      page_id: uuid(),\n      session_id: uuid(),\n    };\n    if (bot) payload.bot = true;\n\n    payload.sri = false;\n\n    // Use User-Agent Client Hints for better privacy\n    // https://web.dev/user-agent-client-hints/\n    if (uaData) {\n      payload.mobile = uaData.mobile;\n      payload.brands = stringify(uaData.brands);\n    }\n\n    /////////////////////\n    // ADD WARNINGS\n    //\n\n\n    // When a customer overwrites the hostname, we need to know what the original\n    // hostname was to hide that domain from referrer traffic\n    if (definedHostname !== locationHostname)\n      payload.hostname_original = locationHostname;\n\n    // Don't track when Do Not Track is set to true\n    if (doNotTrack in nav && nav[doNotTrack] == \"1\")\n      return warn(\n        notSending +\n          \"when \" +\n          doNotTrack +\n          \" is enabled. See \" +\n          docsUrl +\n          \"/dnt\"\n      );\n\n    // Warn when sending from localhost and not having a hostname set\n    if (\n      (locationHostname.indexOf(\".\") == -1 ||\n        /^[0-9.:]+$/.test(locationHostname)) &&\n      !overwrittenHostname\n    )\n      warn(\n        \"Set a hostname when sending data from \" +\n          locationHostname +\n          \". See \" +\n          docsUrl +\n          \"/overwrite-domain-name\"\n      );\n\n    /////////////////////\n    // SETUP INITIAL VARIABLES\n    //\n\n    var page = {};\n    var lastSendPath;\n\n    // We don't want to end up with sensitive data so we clean the referrer URL\n    var referrer =\n      (doc.referrer || \"\")\n        .replace(locationHostname, definedHostname)\n        .replace(/^https?:\\/\\/((m|l|w{2,3}([0-9]+)?)\\.)?([^?#]+)(.*)$/, \"$4\")\n        .replace(/^([^/]+)$/, \"$1\") || undefinedVar;\n\n    // The prefix utm_ is optional\n    var utmRegexPrefix = \"(utm_)?\";\n    var source = {\n      source: getParams(utmRegexPrefix + \"source|ref\"),\n      medium: getParams(utmRegexPrefix + \"medium\"),\n      campaign: getParams(utmRegexPrefix + \"campaign\"),\n      term: getParams(utmRegexPrefix + \"term\"),\n      content: getParams(utmRegexPrefix + \"content\"),\n      referrer: referrer,\n    };\n\n    /////////////////////\n    // TIME ON PAGE AND SCROLLED LOGIC\n    //\n\n    // We don't put msHidden in if duration block, because it's used outside of that functionality\n    var msHidden = 0;\n\n    var sendBeaconText = \"sendBeacon\";\n\n    var sendOnLeave = function (id, push) {\n      var append = { type: \"append\", original_id: push ? id : payload.page_id };\n\n\n\n      if (push || !(sendBeaconText in nav)) {\n        // sendData will assign payload to request\n        sendData(append);\n      } else {\n        nav[sendBeaconText](\n          fullApiUrl + \"/append\",\n          stringify(assign(payload, append))\n        );\n      }\n    };\n\n\n    addEventListenerFunc(pagehide, sendOnLeave, false);\n\n\n    /////////////////////\n    // ACTUAL PAGE VIEW LOGIC\n    //\n\n    var getPath = function (overwrite) {\n      var path = \"\";\n\n      // decodeURIComponent can fail when having invalid characters\n      // https://github.com/simpleanalytics/roadmap/issues/462\n      try {\n        path = overwrite || decodeURIComponentFunc(loc.pathname);\n      } catch (e) {\n        // Do nothing\n      }\n\n\n\n      return path;\n    };\n\n    // Send page view and append data to it\n    var sendPageView = function (isPushState, deleteSourceInfo, sameSite) {\n      if (isPushState) sendOnLeave(\"\" + payload.page_id, true);\n      payload.page_id = uuid();\n\n      var currentPage = definedHostname + getPath();\n\n      sendData(\n        assign(\n          deleteSourceInfo\n            ? {\n                referrer: sameSite ? referrer : null,\n              }\n            : source,\n          {\n            id: payload.page_id,\n            type: pageviewsText,\n          }\n        )\n      );\n\n      referrer = currentPage;\n    };\n\n    var pageview = function (isPushState, pathOverwrite) {\n      // Obfuscate personal data in URL by dropping the search and hash\n      var path = getPath(pathOverwrite);\n\n      // Don't send the last path again (this could happen when pushState is used to change the path hash or search)\n      if (!path || lastSendPath == path) return;\n\n      lastSendPath = path;\n      page.path = path;\n\n\n      if (nav[language]) page[language] = nav[language];\n\n\n      // If a user does refresh we need to delete the referrer because otherwise it count double\n      var perf = window.performance;\n      var navigation = \"navigation\";\n\n      // Check if back, forward or reload buttons are being used in modern browsers\n      var userNavigated =\n        perf &&\n        perf.getEntriesByType &&\n        perf.getEntriesByType(navigation)[0] &&\n        perf.getEntriesByType(navigation)[0].type\n          ? [\"reload\", \"back_forward\"].indexOf(\n              perf.getEntriesByType(navigation)[0].type\n            ) > -1\n          : // Check if back, forward or reload buttons are being use in older browsers\n            // 1: TYPE_RELOAD, 2: TYPE_BACK_FORWARD\n            perf &&\n            perf[navigation] &&\n            [1, 2].indexOf(perf[navigation].type) > -1;\n\n      // Check if referrer is the same as current real hostname (not the defined hostname!)\n      var sameSite = referrer\n        ? doc.referrer.split(slash)[2] == locationHostname\n        : false;\n\n\n      var triggerSendPageView = function () {\n        fetchedHighEntropyValues = true;\n        sendPageView(isPushState, isPushState || userNavigated, sameSite);\n      };\n\n      if (!fetchedHighEntropyValues) {\n        // Request platform information if this is available\n        try {\n          if (uaData && isFunction(uaData.getHighEntropyValues)) {\n            uaData\n              .getHighEntropyValues([platformText, platformVersionText])\n              .then(function (highEntropyValues) {\n                payload.os_name = highEntropyValues[platformText];\n                payload.os_version = highEntropyValues[platformVersionText];\n                triggerSendPageView();\n              })\n              .catch(triggerSendPageView);\n          } else {\n            triggerSendPageView();\n          }\n        } catch (e) {\n          triggerSendPageView();\n        }\n      } else {\n        triggerSendPageView();\n      }\n    };\n\n\n\n    pageview();\n\n  } catch (e) {\n    warn(e);\n  }\n})(\n  window,\n  {},\n  \"<!--# echo var="http_host" default="" -->\",\n  \"\",\n  \"cdn_light_8\",\n  \"sa_event\"\n);\n"],"names":["window","overwriteOptions","baseUrl","loadedVariable","saGlobal","timezone","https","con","console","doNotTrack","nav","navigator","loc","location","locationHostname","hostname","doc","document","userAgent","fetchedHighEntropyValues","encodeURIComponentFunc","encodeURIComponent","decodeURIComponentFunc","decodeURIComponent","stringify","JSON","addEventListenerFunc","addEventListener","fullApiUrl","undefinedVar","undefined","language","documentElement","uaData","userAgentData","platformText","platformVersionText","docsUrl","isBotAgent","test","warn","message","uuid","Date","now","cryptoObject","crypto","msCrypto","emptyUUID","uuidRegex","replace","c","getRandomValues","Uint8Array","toString","error","r","Math","random","assign","to","arg","arguments","index","length","nextSource","nextKey","Object","prototype","hasOwnProperty","call","getParams","regex","matches","search","match","RegExp","map","m","split","sendData","data","callback","payload","page","Image","src","keys","filter","key","join","Intl","DateTimeFormat","resolvedOptions","timeZone","e","scriptElement","currentScript","querySelector","attr","attribute","getAttribute","overwrittenHostname","mode","definedHostname","bot","ignorePages","version","ua","protocol","page_id","session_id","sri","mobile","brands","hostname_original","notSending","indexOf","lastSendPath","referrer","utmRegexPrefix","source","medium","campaign","term","content","sendBeaconText","sendOnLeave","id","push","append","type","original_id","getPath","overwrite","path","pathname","isPushState","pathOverwrite","perf","performance","navigation","userNavigated","getEntriesByType","sameSite","triggerSendPageView","deleteSourceInfo","currentPage","sendPageView","getHighEntropyValues","then","highEntropyValues","os_name","os_version","catch","pageview"],"mappings":"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"}