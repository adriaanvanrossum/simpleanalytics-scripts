{"version":3,"file":"auto-events.source.js","sources":["auto-events.source.js"],"sourcesContent":["(function saAutomatedEvents(window) {\n  // Skip server side rendered pages\n  if (typeof window === \"undefined\") return;\n\n  var log = function (message, type) {\n    var logger = type === \"warn\" ? console.warn : console.log;\n    return logger(\"Simple Analytics auto events:\", message);\n  };\n\n  var doc = window.document;\n\n  var scriptElement =\n    doc.currentScript || doc.querySelector('script[src*=\"auto-events.js\"]');\n\n  var setting = function (attribute, type, defaultValue) {\n    var value = scriptElement && scriptElement.dataset[attribute];\n\n    // Booleans\n    if (type === \"bool\" && (value === \"true\" || value === \"false\"))\n      return value === \"true\";\n    else if (type === \"bool\") return defaultValue;\n\n    // Arrays\n    if (type === \"array\" && value)\n      return value\n        .split(\",\")\n        .map(function (item) {\n          return item.trim();\n        })\n        .filter(Boolean);\n    else if (type === \"array\") return defaultValue;\n  };\n\n  var collectTypes = setting(\"collect\", \"array\", [\n    \"outbound\",\n    \"emails\",\n    \"downloads\",\n  ]);\n  var fullUrls = setting(\"fullUrls\", \"bool\", false);\n\n  var options = {\n    // What to collect\n    outbound: collectTypes.indexOf(\"outbound\") > -1,\n    emails: collectTypes.indexOf(\"emails\") > -1,\n    downloads: collectTypes.indexOf(\"downloads\") > -1,\n    // Downloads: enter file extensions you want to collect\n    downloadsExtensions: setting(\"extensions\", \"array\", [\n      \"pdf\",\n      \"csv\",\n      \"docx\",\n      \"xlsx\",\n      \"zip\",\n      \"doc\",\n      \"xls\",\n    ]),\n\n    // All: use title attribute if set for event name (for all events)\n    // THIS TAKES PRECEDENCE OVER OTHER SETTINGS BELOW\n    title: setting(\"useTitle\", \"bool\", true),\n    // Outbound: use full URL of the links? false for just the hostname\n    outboundFullUrl: fullUrls,\n    // Downloads: if taking event name from URL, use full URL or just filename (default)\n    downloadsFullUrl: fullUrls,\n  };\n\n  // For minifying the script\n  var optionsLink = options;\n\n  if (typeof optionsLink === \"undefined\")\n    log(\"options object not found, please specify\", \"warn\");\n\n  window.saAutomatedLink = function saAutomatedLink(element, type) {\n    try {\n      if (!element) return log(\"no element found\");\n      var sent = false;\n\n      var callback = function () {\n        if (!sent && !element.hasAttribute(\"target\"))\n          document.location = element.getAttribute(\"href\");\n        sent = true;\n      };\n\n      if (window.sa_event) {\n        var hostname = element.hostname;\n        var pathname = element.pathname;\n        var useTitle = false;\n        if (optionsLink.title && element.hasAttribute(\"title\")) {\n          var theTitle = element.getAttribute(\"title\").trim();\n          if (theTitle != \"\") useTitle = true;\n        }\n\n        var event;\n\n        if (useTitle) {\n          event = theTitle;\n        } else {\n          switch (type) {\n            case \"outbound\": {\n              event = hostname + (optionsLink.outboundFullUrl ? pathname : \"\");\n              break;\n            }\n            case \"download\": {\n              event = optionsLink.downloadsFullUrl\n                ? hostname + pathname\n                : pathname.split(\"/\").pop();\n              break;\n            }\n            case \"email\": {\n              var href = element.getAttribute(\"href\");\n              event = (href.split(\":\")[1] || \"\").split(\"?\")[0];\n              break;\n            }\n          }\n        }\n\n        var clean =\n          type +\n          \"_\" +\n          event.replace(/[^a-z0-9]+/gi, \"_\").replace(/(^_+|_+$)/g, \"\");\n\n        sa_event(clean, callback);\n\n        log(\"collected \" + clean);\n\n        return window.setTimeout(callback, 5000);\n      } else {\n        log(\"sa_event is not defined\", \"warn\");\n        return callback();\n      }\n    } catch (error) {\n      log(error.message, \"warn\");\n    }\n  };\n\n  function onDOMContentLoaded() {\n    try {\n      var a = document.getElementsByTagName(\"a\");\n\n      // Loop over all links on the page\n      for (var i = 0; i < a.length; i++) {\n        var link = a[i];\n        var collect = false;\n\n        // We don't want to overwrite website behaviour so we check for the onclick attribute\n        if (!link.getAttribute(\"onclick\")) {\n          // Collect download clicks\n          if (\n            optionsLink.downloads &&\n            /^https?:\\/\\//i.test(link.href) &&\n            new RegExp(\n              \".(\" + (optionsLink.downloadsExtensions || []).join(\"|\") + \")\",\n              \"i\"\n            ).test(link.pathname)\n          ) {\n            collect = \"download\";\n\n            // Collect outbound links clicks\n          } else if (\n            optionsLink.outbound &&\n            /^https?:\\/\\//i.test(link.href) &&\n            link.hostname !== window.location.hostname\n          ) {\n            collect = \"outbound\";\n\n            // Collect email clicks\n          } else if (optionsLink.emails && /^mailto:/i.test(link.href)) {\n            collect = \"email\";\n          }\n\n          if (collect) {\n            var onClickAttribute = \"saAutomatedLink(this, '\" + collect + \"');\";\n\n            if (\n              !link.hasAttribute(\"target\") ||\n              link.getAttribute(\"target\") === \"_self\"\n            )\n              onClickAttribute += \" return false;\";\n\n            link.setAttribute(\"onclick\", onClickAttribute);\n          }\n        }\n      }\n    } catch (error) {\n      log(error.message, \"warn\");\n    }\n  }\n\n  if (doc.readyState === \"ready\" || doc.readyState === \"complete\") {\n    onDOMContentLoaded();\n  } else {\n    document.addEventListener(\"readystatechange\", function (event) {\n      if (event.target.readyState === \"complete\") onDOMContentLoaded();\n    });\n  }\n})(window);\n"],"names":["onDOMContentLoaded","a","document","getElementsByTagName","i","length","onClickAttribute","link","collect","getAttribute","optionsLink","downloads","test","href","RegExp","downloadsExtensions","join","pathname","outbound","hostname","window","location","emails","hasAttribute","setAttribute","error","log","message","doc","scriptElement","setting","collectTypes","fullUrls","type","console","warn","currentScript","querySelector","attribute","defaultValue","value","dataset","split","map","item","trim","filter","Boolean","indexOf","title","outboundFullUrl","downloadsFullUrl","saAutomatedLink","element","sent","callback","sa_event","theTitle","useTitle","event","pop","clean","replace","setTimeout","readyState","addEventListener","target"],"mappings":"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"}